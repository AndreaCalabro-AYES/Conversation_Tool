# Use an ARM64-compatible full Python 3.8 image for Raspberry Pi 4
FROM arm64v8/python:3.8-buster

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive

# Set the working directory inside the container
WORKDIR /app

# Install system dependencies and development headers
RUN apt-get update && apt-get install -y \
    build-essential \
    python3-dev \
    libffi-dev \
    libatlas-base-dev \
    gfortran \
    libhdf5-dev \
    libc-ares-dev \
    libeigen3-dev \
    libopenblas-dev \
    libopenmpi-dev \
    liblapack-dev \
    wget \
    && apt-get clean

# Install TensorFlow Lite
RUN pip install tflite-runtime

# Install Rasa, NLTK, and Scikit-learn
RUN pip install rasa==3.5.10 \
    nltk==3.8.1 \
    scikit-learn==1.1.3

# Copy the application code into the container
COPY . .

# Expose the port for Rasa
EXPOSE 5005

# Set the default command to run the Rasa server
CMD ["rasa", "run", "--enable-api", "--cors", "*"]
