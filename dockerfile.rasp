# Use an ARM64-compatible Python 3.10 slim image
FROM arm64v8/python:3.10-slim-bullseye

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    curl \
    librdkafka-dev \
    wget \
    && apt-get clean

# Install Mamba for managing Python environments
RUN wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-pypy3-Linux-aarch64.sh \
    && bash Mambaforge-pypy3-Linux-aarch64.sh -b -p /opt/mambaforge \
    && /opt/mambaforge/bin/mamba init

# Update Mamba and create a Python environment
RUN /opt/mambaforge/bin/mamba update mamba \
    && /opt/mambaforge/bin/mamba create -n rasa-env python=3.10 \
    && /opt/mambaforge/bin/mamba activate rasa-env

# Install TensorFlow and other dependencies
RUN pip install tensorflow==2.11.0 \
    && pip install rasa==3.5.10 
    # && pip install scikit-learn==1.1.3 nltk==3.8.1

# Copy the application code into the container
COPY . .
